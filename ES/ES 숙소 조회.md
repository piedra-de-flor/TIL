# μ™μ† κ²€μƒ‰μ— Elasticsearch λ„μ… μ‹ κ³ λ ¤μ‚¬ν•­ μ •λ¦¬

## 1. λ„μ… λ°°κ²½ λ° λ©μ 

| ν•­λ© | μ„¤λ… |
|------|------|
| λ©μ  | μ‚¬μ©μ μΉν™”μ μΈ μ™μ† κ²€μƒ‰ UX μ κ³µ |
| κΈ°μ΅΄ ν•κ³„ | `LIKE`, `IN`, `=`, `AND` κΈ°λ° RDB μΏΌλ¦¬λ” μμ—°μ–΄ κ²€μƒ‰μ— ν•κ³„ |
| κΈ°λ€ ν¨κ³Ό | - Full-text κ²€μƒ‰<br>- μλ™μ™„μ„±<br>- μ¤νƒ€ ν—μ©<br>- κ²€μƒ‰ κ²°κ³Ό μ •λ ¬ μµμ ν™” |

---

## 2. μ£Όμ” μ”κµ¬μ‚¬ν•­ (κ²€μƒ‰ κΈ°λ¥)

| κΈ°λ¥ | μ„¤λ… |
|------|------|
| ν‚¤μ›λ“ κ²€μƒ‰ | "μ μ£Ό νΈν…”" β†’ μ™μ†λ…, νƒκ·Έ, μ„¤λ… λ“±μ—μ„ ν‚¤μ›λ“ λ§¤μΉ­ |
| μμ—°μ–΄ λ¬Έμ¥ μ²λ¦¬ | "μ μ£Ό λ°”λ‹¤ λ³΄μ΄λ” νΈν…”" β†’ μ„μΉ + λ·° + μ™μ† νƒ€μ… ν•΄μ„ |
| μλ™μ™„μ„± | "μ μ£Ό" μ…λ ¥ μ‹ "μ μ£Ό λΌλ§λ‹¤ νΈν…”", "μ μ£Ό μ¤μ…λ·° λ¦¬μ΅°νΈ" μ¶”μ² |
| μ¤νƒ€ ν—μ© | "λ³΄μ΄λ νΈν…”" β†’ "λ³΄μ΄λ” νΈν…”" κ²€μƒ‰ κ²°κ³Ό μ κ³µ |
| μ°μ„ μμ„ μ •λ ¬ | μ™μ†λ…μ— ν¬ν•¨λλ©΄ λ†’μ€ μ μ λ¶€μ—¬ (Boost) |
| λ³µν•© μ΅°κ±΄ ν•„ν„° | κ°€κ²©λ€, μ™μ† νƒ€μ…, ν‰μ , μ§€μ—­ λ“±μΌλ΅ μ¶”κ°€ ν•„ν„°λ§ κ°€λ¥ |

---

## 3. κΈ°μ μ  κ³ λ―Ό ν¬μΈνΈ

| κµ¬λ¶„ | κ³ λ―Ό λ‚΄μ© |
|------|-----------|
| κ²€μƒ‰ μ •ν™•λ„ | ν•νƒμ† λ¶„μ„κΈ° μ„ νƒ (`nori`, `arirang`, μ‚¬μ©μ μ •μ λ“±) |
| μ„±λ¥ | κ²€μƒ‰ μ‘λ‹µ μ†λ„, λ¶„μ„κΈ° λΉ„μ©, μ¤μΌ€μΌμ—… μ‹ λ…Έλ“ μ κ³ λ ¤ |
| λ°μ΄ν„° λ™κΈ°ν™” | RDB β†” ES λ™κΈ°ν™” (CDC, λΉ„λ™κΈ° ν, Bulk API λ“±) |
| μƒ‰μΈ κµ¬μ΅° | μ–΄λ–¤ ν•„λ“λ¥Ό `text`, μ–΄λ–¤ ν•„λ“λ¥Ό `keyword`λ΅ μ²λ¦¬ν• μ§€ |
| κ²€μƒ‰ ν’μ§ νλ‹ | Boost μ„¤μ •, Analyzer νλ‹, Synonym μ¶”κ°€ λ“± |
| π› μ΄μ | ES ν΄λ¬μ¤ν„° μ΄μ, μƒ‰μΈ μ¬λΉλ“, λ΅κ·Έ μ¶”μ  λ“± |

---

## 4. κµ¬ν„ λ‹¨κ³„

### 4.1 μƒλ΅μ΄ μ™μ† λ„λ©”μΈ λ¨λΈ μμ‹
```json
{
  "id": 123,
  "name": "μ μ£Ό λΌλ§λ‹¤ νΈν…”",
  "lentPrice": 123,
   ...
   ...
  "description": "μ—λ©”λ„λ“λΉ› λ°”λ‹¤ μ „λ§, κ³µν•­ κ·Όμ² μ„μΉ",
  "location": "μ μ£ΌνΉλ³„μμΉλ„ μ μ£Όμ‹",
  "type": "νΈν…”",
  "tags": ["μ¤μ…λ·°", "λ°”λ‹¤", "νΈν…”", "κ³µν•­", "μ μ£Ό"]
}
```

## 4.2 Elasticsearch λ§¤ν•‘ κµ¬μ΅°

| ν•„λ“λ… | νƒ€μ… | μ„¤λ… |
|--------|------|------|
| `name` | text | μ™μ† μ΄λ¦„. ν•νƒμ† λ¶„μ„κΈ° μ μ© (κ²€μƒ‰ κ°€μ¤‘μΉ λ†’μ) |
| `description` | text | μ™μ† μ„¤λ… ν…μ¤νΈ. μμ λ΅μ΄ κ²€μƒ‰ λ€μƒ |
| `tags` | text | ν‚¤μ›λ“ κΈ°λ° κ²€μƒ‰μ© νƒκ·Έ (ex: λ°”λ‹¤, μ¤μ…λ·°) |
| `location` | text | μ§€μ—­λ…, μ£Όμ† (μ μ£Ό, μ„κ·€ν¬ λ“±) |
| `type` | keyword | μ™μ† νƒ€μ… (νΈν…”, λ¦¬μ΅°νΈ, κ²μ¤νΈν•μ°μ¤ λ“±) |
| `name_suggest` | completion | μλ™μ™„μ„± μ „μ© ν•„λ“ (prefix κΈ°λ° μ¶”μ²) |

> `text` νƒ€μ…μ—λ” analyzerκ°€ μ μ©λμ–΄ μμ—°μ–΄ κ²€μƒ‰ κ°€λ¥  
> `keyword`λ” μ •λ ¬, μ •ν™•ν• ν•„ν„°λ§μ— μ‚¬μ©  
> `completion`μ€ μλ™μ™„μ„± κµ¬ν„μ— ν•„μ

---

## 5. κ²€μƒ‰ μΏΌλ¦¬ μ „λµ

### 5.1 μμ—°μ–΄ ν‚¤μ›λ“ κ²€μƒ‰ (multi_match)

| ν•­λ© | μ„¤λ… |
|------|------|
| λ©μ  | μ‚¬μ©μμ λ³µν•© λ¬Έμ¥μ„ μ—¬λ¬ ν•„λ“μ— κ²€μƒ‰ |
| λ°©μ‹ | `multi_match`λ΅ `name`, `description`, `tags` ν•„λ“λ¥Ό λ™μ‹μ— κ²€μƒ‰ |
| κ°€μ¤‘μΉ | `name^3`, `tags^2` λ“± μ¤‘μ”λ„μ— λ”°λΌ λ¶€μ—¬ |

```json
{
  "query": {
    "multi_match": {
      "query": "μ μ£Ό λ°”λ‹¤ λ³΄μ΄λ” νΈν…”",
      "fields": ["name^3", "tags^2", "description"]
    }
  }
}
```

### 5.2 μ¤νƒ€ ν—μ© κ²€μƒ‰ (fuzzy match)

| ν•­λ© | μ„¤λ… |
|------|------|
| λ©μ  | μ‚¬μ©μμ μ…λ ¥ μ‹¤μλ¥Ό ν—μ© (μ: 'λ³΄μ΄λ' β†’ 'λ³΄μ΄λ”') |
| λ°©μ‹ | `match` μΏΌλ¦¬μ— `fuzziness: AUTO` μµμ… μ„¤μ • |
| μ¶”μ² μƒν™© | λ¨λ°”μΌ ν™κ²½, μ‚¬μ©μ μ¤μ…λ ¥ κ³ λ ¤ μ‹ μ μ© |

```json
{
  "query": {
    "match": {
      "name": {
        "query": "λ³΄μ΄λ νΈν…”",
        "fuzziness": "AUTO"
      }
    }
  }
}
```

### 5.3 μλ™μ™„μ„± κΈ°λ¥ (completion suggest)

| ν•­λ© | μ„¤λ…                                      |
| -- | --------------------------------------- |
| λ©μ  | κ²€μƒ‰μ°½μ— μ…λ ¥ν•λ” λ™μ• μ¶”μ² κ²€μƒ‰μ–΄ μ κ³µ                  |
| ν•„λ“ | `name_suggest` ν•„λ“λ¥Ό `completion` νƒ€μ…μΌλ΅ μƒ‰μΈ |
| μµμ… | `prefix`, `fuzzy` μ΅°ν•©μΌλ΅ μ‹¤μ‹κ°„ μ¶”μ² κ°€λ¥        |

```json
{
  "suggest": {
    "hotel-suggest": {
      "prefix": "μ μ£Ό",
      "completion": {
        "field": "name_suggest",
        "fuzzy": true
      }
    }
  }
}
```
## 6. λ°μ΄ν„° λ™κΈ°ν™” μ „λµ

| λ°©μ‹               | μ„¤λ…                                  | μ¥μ                 | λ‹¨μ                   |
| ---------------- | ----------------------------------- | ----------------- | ------------------- |
| **Dual Write**   | RDB μ €μ¥ μ‹ ESμ—λ„ λ™μ‹ μƒ‰μΈ                 | κµ¬ν„ κ°„λ‹¨, λΉ λ¥Έ μ μ©      | νΈλμ­μ… λ¶„λ¦¬λ¨, μ‹¤ν¨ λ³µκµ¬ μ–΄λ ¤μ›€ |
| **Kafka λΉ„λ™κΈ° μ²λ¦¬** | μ €μ¥ ν›„ Kafka μ΄λ²¤νΈ λ°ν–‰ β†’ Consumerκ°€ ES μƒ‰μΈ | ν™•μ¥μ„± μ°μ, μ¥μ•  λ³µμ› μ©μ΄  | κµ¬μ΅° λ³µμ΅, μ‹¤μ‹κ°„μ„± μ•½κ°„ λ‚®μ   |
| **Debezium CDC** | RDB binlog κΈ°λ° λ³€κ²½ κ°μ§€ β†’ ES μƒ‰μΈ         | μ •ν•©μ„± λ³΄μ¥, μ‹μ¤ν… λ¶„λ¦¬ κ°€λ¥ | μ„Έν… λ³µμ΅, μ΄μ λ‚μ΄λ„ β†‘     |


## 7. κ²€μƒ‰ ν’μ§ ν–¥μƒ μ „λµ

| ν•­λ©                        | μ„¤λ…                   | μμ‹ / μ „λµ                             |
| ------------------------- | -------------------- | ----------------------------------- |
| **ν•νƒμ† λ¶„μ„κΈ° μ„¤μ •**            | ν•κµ­μ–΄μ— μ ν•©ν• analyzer μ„ νƒ | `nori`, `seunjeon`, μ‚¬μ©μ μ •μ          |
| **λ™μμ–΄ μ‚¬μ „ μ„¤μ •**             | μ μ‚¬ λ‹¨μ–΄ λ§¤ν•‘μΌλ΅ κ²€μƒ‰ μ μ—°μ„± β†‘  | `"λ°”λ‹¤"` β‰ `"μ¤μ…"`, `"μ™μ†"` β‰ `"νΈν…”"`    |
| **Boost μ „λµ**              | κ²€μƒ‰ λ€μƒ ν•„λ“λ³„ κ°€μ¤‘μΉ μ°¨λ“± λ¶€μ—¬  | `name^3`, `tags^2`, `description^1` |
| **Function Score**        | ν‰μ , λ¦¬λ·°μ λ“±μ„ μ¤μ½”μ–΄μ— λ°μ   | `score = text_score * ν‰μ  * λ¦¬λ·°λ³΄μ •κ°’`   |
| **λ¶μ©μ–΄ μ κ±° / tokenizer μ„¤μ •** | μ΅°μ‚¬, μ ‘μ‚¬ μ κ±°λ΅ μλ―Έ λ‹¨μ–΄λ§ μ¶”μ¶ | `"μ μ£Όμ"` β†’ `"μ μ£Ό"`                    |
| **κ²€μƒ‰ λ΅κ·Έ κΈ°λ° νλ‹**           | μ‚¬μ©μ κ²€μƒ‰ ν¨ν„΄μ„ κΈ°λ°μΌλ΅ κ°μ„    | μΈκΈ° κ²€μƒ‰μ–΄, λ…Έμ¶ μ°μ„ μμ„ μ΅°μ •                  |
