# AirDrop의 작동 원리: 컴퓨터 사이언스 관점

## 1. AirDrop이란?

AirDrop은 Apple이 개발한 근거리 무선 파일 전송 기술
사용자는 별도의 설정 없이도 주변의 Apple 기기와 안전하게 파일을 주고받을 수 있음

## 에어드랍 동작 순서

[BLE Advertising + mDNS] \
↓ \
[SHA-256 연락처 인증 / 공개키 기반 식별] \
↓ \
[AWDL/Wi-Fi Direct로 P2P 연결 설정] \
↓ \
[TLS Handshake → 세션 키 설정] \
↓ \
[TCP/IP 기반 파일 전송] \
↓ \
[세션 종료 및 연결 해제]



## 1. [BLE Advertising + mDNS]
- Bluetooth LE Advertising
  - 무선 물리 계층 & 링크 계층의 저전력 탐색 (BLE)
  - 주변 기기가 자신을 알리기 위해 주기적으로 무선 신호를 송출
  - 기기 이름, UUID, 상태 정보 등을 포함
  - 저전력 설계로 배터리 소모 최소화

- mDNS (Multicast DNS)
  - 로컬 네트워크에서 IP 주소 없이도 호스트 이름을 찾도록 설계
  - Zero-configuration 네트워킹 및 분산 서비스 검색

    
## 2. [SHA-256 연락처 인증 / 공개키 기반 식별]
- 연락처 인증 목적
  - AirDrop의 "연락처만" 모드에서는 송신자와 수신자가 서로의 연락처 정보가 있는지 검증 필요

- SHA-256 해시 비교
  - 연락처 정보를 해시화하여 개인정보 노출 없이 비교 가능

- 공개키 기반 식별
  - 각 기기는 자신의 개인키-공개키 쌍을 가지고 있음
  - 메시지 서명과 확인을 통해 신원 검증 수행


## 3. [AWDL/Wi-Fi Direct로 P2P 연결 설정]
- AWDL (Apple Wireless Direct Link)
  - 애플이 Wi-Fi MAC/PHY 위에서 구현한 독자적인 P2P 프로토콜
  - 시간 슬롯(Time-Slot) 기반 무선 채널 공유로 효율적 자원 사용
  - 링크 로컬 IPv6 주소 할당 및 라우팅

- Wi-Fi Direct
  - 표준 Wi-Fi P2P 프로토콜로 라우터 없이 두 장치 직접 연결


## 4. [TLS Handshake → 세션 키 설정]
- TLS (Transport Layer Security)
  - 전송 계층 암호화 프로토콜
  - 연결 초기 단계에서 키 교환 및 암호화 알고리즘 협상

- 핸드쉐이크 과정
  - ECDHE(Elliptic Curve Diffie-Hellman Ephemeral)를 이용해 세션 키 교환
  - 서버/클라이언트 인증 (공개키 기반)


## 5. [TCP/IP 기반 파일 전송]
- TCP (Transmission Control Protocol)
  - 신뢰성 있는 스트림 전송 보장
  - 데이터 순서 보장, 재전송, 흐름 제어, 혼잡 제어

- IP (Internet Protocol)
  - AWDL을 통해 할당된 IPv6 링크 로컬 주소 사용

- 왜 UDP가 아닌 TCP?
  - AirDrop은 파일 전송을 다루기 때문에 데이터 손실이나 순서 뒤바뀜이 있으면 안됨
  - AirDrop은 사용자 경험을 위해 안정적인 연결 유지와 전송 종료를 깔끔하게 처리할 필요가 있음
  - AirDrop은 TLS로 데이터를 암호화하는데, TLS는 TCP 위에서 동작하도록 설계되어 있음

## 6. [세션 종료 및 연결 해제]
- TCP 연결 종료
  - 4-way 핸드쉐이크 (FIN, ACK 패킷 교환)로 연결 정상 종료

- TLS 세션 종료
  - 암호화 세션 키 폐기